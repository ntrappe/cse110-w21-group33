<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: components/pomo-timer.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: components/pomo-timer.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import {
  setStartButton,
  setResetButton,
  display,
  setTime,
  initProgess,
  setProgressHelper,
} from './pomo-timer-helpers.js';

const START = 'Start';
const SEC_SPEED = 250;
class PomoTimer extends HTMLElement {
  constructor() {
    super();

    const shadow = this.attachShadow({ mode: 'open' });

    const style = document.createElement('style');
    const darkStyle = document.createElement('link');
    darkStyle.setAttribute('id', 'timer-style-dark');
    darkStyle.setAttribute('rel', 'stylesheet');
    darkStyle.setAttribute('href', './components/pomo-timer.css');
    shadow.append(darkStyle);

    const wrapper = document.createElement('span');
    wrapper.setAttribute('class', 'wrapper');

    // label for mode e.g. 'Work'
    const currentMode = document.createElement('p');
    currentMode.setAttribute('id', 'timer-mode');

    // squares to represent progress
    const progressContainerItems = initProgess();
    const progressContainer = progressContainerItems[0];
    progressContainer.setAttribute('id', 'timer-progress-container');

    // timer countdown display
    const timerText = document.createElement('h1');
    timerText.setAttribute('id', 'timer-text');
    timerText.setAttribute('class', 'time');

    // timer button
    const timerButton = document.createElement('button');
    timerButton.setAttribute('id', 'timer-button');
    timerButton.setAttribute('class', 'start');

    /* Initialize elements */
    timerButton.textContent = START;

    let ticker; // timer object
    this.totalSeconds = 0; // total seconds in timer
    let modeDuration = 0; // time to put on clock
    this.calmTimerText = false; // display w or w/o sec

    shadow.appendChild(wrapper);
    shadow.appendChild(style);
    wrapper.appendChild(currentMode);
    wrapper.appendChild(progressContainer);
    wrapper.appendChild(timerText);
    wrapper.appendChild(timerButton);

    /* Events */
    const timerStartEvent = new CustomEvent('timerStart', {
      bubbles: true, // event listenable outside of container
      composed: true,
    });

    const timerResetEvent = new CustomEvent('timerReset', {
      bubbles: true,
      composed: true,
    });

    const timerFinishEvent = new CustomEvent('timerFinish', {
      bubbles: true,
      composed: true,
    });

    const tickEvent = new CustomEvent('tick', {
      bubbles: true,
      composed: true,
      detail: { timeRemaining: () => this.totalSeconds },
    });

    /**
     * Function calls to toggle button and control timer based on user input
     */
    timerButton.onclick = () => {
      if (timerButton.textContent === START) {
        setResetButton(timerButton);
        this.timerStart();
      } else {
        setStartButton(timerButton);
        this.timerReset();
      }
    };

    /**
     * Stops the timer from ticking and resets it based on button click
     */
    this.timerReset = () => {
      shadow.dispatchEvent(timerResetEvent);
      clearInterval(ticker);
      this.totalSeconds = setTime(modeDuration);
      display(this.totalSeconds, timerText, this.calmTimerText);
    };

    /**
     * Sets time on timer and starts ticking based on button click
     */
    this.timerStart = () => {
      shadow.dispatchEvent(timerStartEvent);
      this.totalSeconds = setTime(modeDuration);
      display(this.totalSeconds, timerText, this.calmTimerText);
      ticker = setInterval(this.timerTick, SEC_SPEED);
    };

    /**
     * Timer hits 0:00 and resets
     */
    this.timerFinish = () => {
      shadow.dispatchEvent(timerFinishEvent);
      clearInterval(ticker);
      this.totalSeconds = setTime(modeDuration);
      display(this.totalSeconds, timerText, this.calmTimerText);
    };

    /**
     * Decrement each second. If time has run out, stop "ticking" by clearing Interval and
     * reset the timer. Otherwise, keep decrementing seconds and updating time on screen
     */
    this.timerTick = () => {
      shadow.dispatchEvent(tickEvent);
      if (this.totalSeconds === 0) {
        this.timerFinish();
        setStartButton(timerButton);
      } else {
        this.totalSeconds -= 1;
        display(this.totalSeconds, timerText, this.calmTimerText);
      }
    };

    /**
     * For CONTROL to set time on clock for current mode
     * @param {Number} min number of minutes to set the clock to
     */
    this.setTimer = (min, mode) => {
      modeDuration = min;
      this.totalSeconds = setTime(min);
      display(this.totalSeconds, timerText, this.calmTimerText);
      currentMode.setAttribute('class', mode);
      currentMode.textContent = mode.toUpperCase();
    };

    /**
     * For CONTROL to update squares on screen to match number of breaks taken
     * @param {Number} progress - number of breaks taken
     */
    this.setProgress = (progress) => {
      setProgressHelper(
        progress,
        progressContainerItems[1],
        progressContainerItems[2],
        progressContainerItems[3],
        progressContainerItems[4]
      );
    };

    /**
     * For CONTROL to determine if timer text display will show normal
     * minutes &amp; seconds or just minutes
     * @param {Boolean} calm true for min; false for min and sec
     */
    this.setCalm = (calm) => {
      this.calmTimerText = calm;
      display(this.totalSeconds, timerText, this.calmTimerText);
    };

    /**
     * For CONTROL to determine whether to use default dark styling
     * or use light to override some colors of dark
     * @param {Boolean} dark true for dark css; false for light css
     */
    this.setDark = (dark) => {
      if (dark) {
        if (shadow.getElementById('timer-style-light')) {
          shadow.removeChild(shadow.getElementById('timer-style-light'));
        }
      } else {
        const lightStyle = document.createElement('link');
        lightStyle.setAttribute('id', 'timer-style-light');
        lightStyle.setAttribute('rel', 'stylesheet');
        lightStyle.setAttribute('href', './components/pomo-timer-light.css');
        shadow.append(lightStyle);
      }
    };

    /* add style to progress section */
    style.textContent = `
      .progress-container {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
      }

      .square-off {
        color: #171b21;
        background-color: #171b21;
        border: 1px solid;
        padding: 7px;
        border-radius: 3px;
        border-color: #171b21;
      }

      .square-on {
        color: #429046;
        background-color: #429046;
        border: 1px solid;
        padding: 7px;
        border-radius: 3px;
        border-color: #55a758;
      }

      #square4[class="square-on"] {
        color: #67c75c;
        background-color: #67c75c;
        border: 1px solid;
        padding: 7px;
        border-radius: 3px;
        border-color: #8ce96b;
      }
    `;
  }
}

customElements.define('pomo-timer', PomoTimer);

export default PomoTimer;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#defaultTab">defaultTab</a></li><li><a href="global.html#display">display</a></li><li><a href="global.html#getAccessibility">getAccessibility</a></li><li><a href="global.html#getCalm">getCalm</a></li><li><a href="global.html#getDark">getDark</a></li><li><a href="global.html#getDayCount">getDayCount</a></li><li><a href="global.html#getLongBreak">getLongBreak</a></li><li><a href="global.html#getShortBreak">getShortBreak</a></li><li><a href="global.html#getSound">getSound</a></li><li><a href="global.html#getVolume">getVolume</a></li><li><a href="global.html#getWork">getWork</a></li><li><a href="global.html#initProgess">initProgess</a></li><li><a href="global.html#setAccessibility">setAccessibility</a></li><li><a href="global.html#setCalm">setCalm</a></li><li><a href="global.html#setDark">setDark</a></li><li><a href="global.html#setDayCount">setDayCount</a></li><li><a href="global.html#setLongBreak">setLongBreak</a></li><li><a href="global.html#setProgressHelper">setProgressHelper</a></li><li><a href="global.html#setResetButton">setResetButton</a></li><li><a href="global.html#setShortBreak">setShortBreak</a></li><li><a href="global.html#setSound">setSound</a></li><li><a href="global.html#setStartButton">setStartButton</a></li><li><a href="global.html#setTab">setTab</a></li><li><a href="global.html#setTime">setTime</a></li><li><a href="global.html#setVolume">setVolume</a></li><li><a href="global.html#setWork">setWork</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Sun Mar 14 2021 00:07:39 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
