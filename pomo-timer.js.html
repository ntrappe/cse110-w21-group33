<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: pomo-timer.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: pomo-timer.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { setStartButton, setResetButton, display, set, initProgess, setProgressHelper } from './pomo-timer-helpers.js'

const START = 'Start';
const RESET = 'Reset';
const SEC_SPEED = 250;
class PomoTimer extends HTMLElement {
    constructor() {
        super();

        const shadow = this.attachShadow({mode: 'open'});

        /*
        const link = document.createElement('link');
        link.setAttribute('id', 'timer-styles');
        link.setAttribute('rel', 'stylesheet');
        link.setAttribute('href', './components/pomo-timer.css');
        */

        const wrapper = document.createElement('span');
        wrapper.setAttribute('class', 'wrapper');

        // label for mode e.g. 'Work'
        let currentMode = document.createElement('p');          
        currentMode.setAttribute('id', 'timer-mode'); 

        // timer countdown display
        let timerText = document.createElement('h1')  
        timerText.setAttribute('id', 'timer-text');          
        timerText.setAttribute('class', 'time');

        // timer button
        let timerButton = document.createElement('button'); 
        timerButton.setAttribute('id', 'timer-button');
        timerButton.setAttribute('class', 'start');

        /* Initialize elements */
        /*
        currentMode.textContent = "WORK";
        timerText.textContent = "TIME"; */
        timerButton.textContent = START; 

        let ticker;                                             // timer object
        this.totalSeconds = 0;                                  // total seconds in timer
        let modeDuration = 0;                                   // time to put on clock

        shadow.appendChild(wrapper);
        wrapper.appendChild(currentMode);
        wrapper.appendChild(timerText);
        wrapper.appendChild(timerButton);

        /* Events */
        const timerStartEvent = new CustomEvent('timerStart', {
            bubbles: true,          // event listenable outside of container
            composed: true
        });

        const timerResetEvent = new CustomEvent('timerReset', {
            bubbles: true,      
            composed: true
        });

        const timerFinishEvent = new CustomEvent('timerFinish', {
            bubbles: true,      
            composed: true
        });

        const tickEvent = new CustomEvent('tick', {
            bubbles: true,      
            composed: true,
            detail: {timeRemaining: () => this.totalSeconds}
        });

        /**
         * Function calls to toggle button and control timer based on user input
         */
        timerButton.onclick = () => {
            if (timerButton.textContent === START) {
                setResetButton(timerButton);
                this.timerStart();
            } else {
                setStartButton(timerButton);
                this.timerReset();
            }
        };

        /**
        * Stops the timer from ticking and resets it based on button click
        */
        this.timerReset = () => {
            shadow.dispatchEvent(timerResetEvent);
            clearInterval(ticker);
            //this.totalSeconds = set(NUM_MIN);
            this.totalSeconds = set(modeDuration);
            display(this.totalSeconds, timerText);
        }

        /**
         * Sets time on timer and starts ticking based on button click
         */
        this.timerStart = () => {
            shadow.dispatchEvent(timerStartEvent);
            //this.totalSeconds = set(NUM_MIN);
            this.totalSeconds = set(modeDuration);
            display(this.totalSeconds, timerText);
            ticker = setInterval(this.timerTick, SEC_SPEED);
        }

        /**
        * Timer hits 0:00 and resets
        */
        this.timerFinish = () => {
            shadow.dispatchEvent(timerFinishEvent);
            clearInterval(ticker);
            //this.totalSeconds = set(NUM_MIN);
            this.totalSeconds = set(modeDuration);
            display(this.totalSeconds, timerText);
        }

        /**
        * Decrement each second. If time has run out, stop "ticking" by clearing Interval and 
        * reset the timer. Otherwise, keep decrementing seconds and updating time on screen
        */
        this.timerTick = () => {
            shadow.dispatchEvent(tickEvent);
            if (this.totalSeconds == 0) {
                this.timerFinish();
                setStartButton(timerButton);
            } else {
                this.totalSeconds = this.totalSeconds - 1;
                display(this.totalSeconds, timerText);
            }  
        }

        /**
         * For CONTROL to set time on clock for current mode
         * @param {Number} min number of minutes to set the clock to
         */
        this.setTimer = (min, mode) => {
            modeDuration = min;
            this.totalSeconds = set(min);
            display(this.totalSeconds, timerText);
            currentMode.setAttribute('class', mode);
            currentMode.textContent = mode.toUpperCase();
        }
        
        /**
         * For CONTROL to update squares on screen to match number of breaks taken
         * @param {Number} progress number of breaks taken
         */
        this.setProgress = (progress) => {
            setProgressHelper(progress, progressContainerItems[1], progressContainerItems[2],
                progressContainerItems[3], progressContainerItems[4]);
        }
    }
}

customElements.define('pomo-timer', PomoTimer);

export { PomoTimer };</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#display">display</a></li><li><a href="global.html#initProgess">initProgess</a></li><li><a href="global.html#set">set</a></li><li><a href="global.html#setProgressHelper">setProgressHelper</a></li><li><a href="global.html#setResetButton">setResetButton</a></li><li><a href="global.html#setStartButton">setStartButton</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Fri Mar 05 2021 08:00:32 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
